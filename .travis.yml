language: node_js
node_js:
  - "10"
sudo: false
dist: xenial

env:
  - HAXE_VERSION=haxe347
  - HAXE_VERSION=haxe4rc5
  - HAXE_VERSION=nightly

install:
  - npm install
  - if [[ "$HAXE_VERSION" == "haxe347" ]]; then mv haxe_libraries haxe4_libraries; mv haxe3_libraries haxe_libraries; fi
  - if [[ "$HAXE_VERSION" == "haxe347" ]]; then npx lix download haxe 3.4.7; npx lix use haxe 3.4.7; fi
  - if [[ "$HAXE_VERSION" == "haxe4rc5" ]]; then npx lix download haxe 4.0.0-rc.5; npx lix use haxe 4.0.0-rc.5; fi
  - if [[ "$HAXE_VERSION" == "nightly" ]]; then npx lix download haxe nightly; npx lix use haxe nightly; fi
  - npx lix download
  - npx haxe -version
  - npx neko -version
  - npx haxelib list

script:
  - npx haxe build.hxml
  - npx haxe buildDebug.hxml
  - npx haxe buildJS.hxml
  - npx haxe buildCpp.hxml
  - npx haxe buildSchema.hxml
  - npx haxe -D codecov_json buildTest.hxml
  - npx haxe testJava.hxml
